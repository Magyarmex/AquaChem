<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AquaChem — O₂ Planner</title>
  <style>
    :root{
      --bg:#0b1020;
      --panel:#111a33;
      --panel2:#0f1730;
      --text:#e7ecff;
      --muted:#a9b3d6;
      --accent:#7aa2ff;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:16px;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      min-height:100vh;
      background:
        radial-gradient(1200px 600px at 15% -10%, rgba(122,162,255,.18), transparent 60%),
        radial-gradient(900px 400px at 90% 0%, rgba(99,230,190,.12), transparent 55%),
        linear-gradient(180deg,#070a14,#0b1020 25%,#0b1020);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }
    .panel{
      max-width:640px;
      width:100%;
      background:linear-gradient(180deg,var(--panel),var(--panel2));
      border:1px solid rgba(122,162,255,.18);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:24px;
    }
    h1{margin:0 0 10px;font-size:22px}
    p{margin:0;color:var(--muted);line-height:1.5}
    .status{
      margin-top:16px;
      padding:12px 14px;
      border-radius:12px;
      border:1px solid rgba(122,162,255,.2);
      background:rgba(122,162,255,.08);
      font-size:13px;
      color:var(--text);
    }
    .status.error{
      border-color:rgba(255,107,107,.4);
      background:rgba(255,107,107,.12);
    }
    .actions{
      margin-top:18px;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
    }
    a.button{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:10px 14px;
      border-radius:12px;
      background:rgba(122,162,255,.22);
      border:1px solid rgba(122,162,255,.4);
      color:var(--text);
      text-decoration:none;
      font-size:13px;
    }
    .muted{font-size:12px;color:var(--muted);margin-top:10px}
  </style>
</head>
<body>
  <div class="panel">
    <h1>AquaChem — O₂ Demand Planner</h1>
    <p>Loading the planner…</p>
    <div id="status" class="status">Checking for the latest build.</div>
    <div class="actions">
      <a class="button" id="openLink" href="o2_planner_uncertainty_fixed5.html">Open planner now</a>
    </div>
    <div class="muted" id="debugHint"></div>
    <noscript>
      <div class="status error" style="margin-top:14px">
        JavaScript is disabled. Please open <a href="o2_planner_uncertainty_fixed5.html">the planner</a> directly.
      </div>
    </noscript>
  </div>

  <script>
    const APP_PATH = 'o2_planner_uncertainty_fixed5.html';
    const statusEl = document.getElementById('status');
    const debugHint = document.getElementById('debugHint');
    const openLink = document.getElementById('openLink');

    const debugState = {
      appPath: APP_PATH,
      startEpoch: Date.now(),
      startPerfMs: (typeof performance !== 'undefined' && performance.now) ? performance.now() : null,
      attempts: 0,
      status: 'init'
    };
    window.__AQUACHEM_BOOT__ = debugState;

    function setStatus(text, isError=false){
      if(statusEl){
        statusEl.textContent = text;
        statusEl.classList.toggle('error', isError);
      }
      debugState.status = text;
    }

    function showDebug(){
      if(!debugHint) return;
      const elapsed = debugState.startPerfMs ? (performance.now() - debugState.startPerfMs) : null;
      const timeInfo = elapsed != null ? `${elapsed.toFixed(0)}ms elapsed` : 'elapsed n/a';
      debugHint.textContent = `Boot diagnostics: ${timeInfo}, attempts=${debugState.attempts}`;
    }

    async function verifyAndRedirect(){
      debugState.attempts += 1;
      showDebug();
      try{
        const res = await fetch(APP_PATH, {method: 'HEAD', cache: 'no-store'});
        debugState.lastStatus = res.status;
        if(res.ok){
          setStatus('Planner found. Redirecting…');
          window.location.replace(APP_PATH);
          return;
        }
        setStatus(`Planner returned ${res.status}. Use the button below.`, true);
      }catch(err){
        debugState.lastError = String(err);
        setStatus('Could not reach planner file. Use the button below.', true);
        console.error('Planner bootstrap error:', err);
      }finally{
        showDebug();
      }
    }

    openLink.addEventListener('click', () => {
      debugState.manualOpen = true;
    });

    setTimeout(() => {
      if(debugState.status === 'init'){
        setStatus('Still checking for the planner…');
        showDebug();
      }
    }, 1200);

    verifyAndRedirect();
  </script>
</body>
</html>
